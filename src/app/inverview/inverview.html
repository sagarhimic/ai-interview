<div class="min-h-screen bg-gray-50 flex items-center justify-center py-10">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl p-8">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6 border-b pb-3">
      <h2 class="text-2xl font-semibold text-gray-800">
        AI Technical Interview - {{ user_info?.data?.job_title }}
      </h2>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>

    <!-- Hidden Form Fields -->
    <form [formGroup]="setupForm" (ngSubmit)="generateQuestions()">
      <div class="hidden">
        <input type="hidden" formControlName="job_title" />
        <input type="hidden" formControlName="job_description" />
        <input type="hidden" formControlName="duration" />
        <input type="hidden" formControlName="experience" />
        <input type="hidden" formControlName="required_skills" />
        <input type="hidden" formControlName="candidate_skills" />
      </div>

      <!-- Start Interview Section -->
      <div *ngIf="!questions.length" class="text-center py-10">
        <h3 class="text-xl font-semibold mb-3">Ready to start your AI-powered interview?</h3>
        <p class="text-gray-500 mb-6">
          Click below to begin generating your interview questions and enable your camera & microphone.
        </p>
        <button type="submit" [disabled]="loadingGenerate"
          class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition">
          {{ loadingGenerate ? 'Generating...' : 'Start Interview' }}
        </button>
      </div>
    </form>

    <!-- ====================== INTERVIEW SECTION ====================== -->
    <div *ngIf="questions.length" class="mt-6">
      
      <!-- Camera Preview -->
      <div class="flex justify-center mb-6">
        <video
          #video
          autoplay
          playsinline
          muted
          width="480"
          height="360"
          class="rounded-lg border shadow"
        ></video>
      </div>

      <!-- Question Display -->
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">
          Question {{ currentIndex + 1 }} / {{ questions.length }}
        </h3>
      </div>

      <div class="bg-gray-100 p-5 rounded-lg shadow-sm mb-5">
        <p class="text-gray-800 text-base leading-relaxed">
          {{ questions[currentIndex]?.question }}
        </p>
      </div>

      <!-- Answer Textarea (Live Speech Display) -->
      <textarea
        #typedAnswer
        [(ngModel)]="finalTranscript"
        class="w-full p-3 border rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500"
        placeholder="Your spoken or typed answer will appear here..."
        rows="5"
      ></textarea>

      <!-- Live Transcript Info -->
      <div class="bg-gray-50 border rounded-md p-3 mb-4" *ngIf="interimTranscript || finalTranscript">
        <p *ngIf="interimTranscript" class="text-sm text-gray-500">
          <strong>Interim:</strong> {{ interimTranscript }}
        </p>
        <p *ngIf="finalTranscript" class="text-sm text-gray-700">
          <strong>Final:</strong> {{ finalTranscript }}
        </p>
      </div>

      <!-- Auto Voice Capture Indicator -->
      <div class="text-center mb-4">
        <span *ngIf="recording" class="inline-block bg-green-500 text-white px-3 py-1 rounded-full text-sm">
          üéôÔ∏è Listening... Please speak your answer
        </span>
        <span *ngIf="!recording" class="inline-block bg-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm">
          Waiting for next question...
        </span>
      </div>

      <!-- Manual Submit Buttons (optional) -->
      <div class="flex justify-center gap-4 mb-4">
        <button
          (click)="submitAnswer(typedAnswer.value)"
          [disabled]="loadingSubmit"
          class="px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md"
        >
          Submit Typed
        </button>
        <button
          (click)="submitAnswer(finalTranscript)"
          [disabled]="loadingSubmit"
          class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md"
        >
          Submit Spoken
        </button>
        <span *ngIf="loadingSubmit" class="text-gray-500 self-center">Submitting...</span>
      </div>

      <!-- Navigation -->
      <!-- <div class="flex justify-between mt-4">
        <button (click)="prev()" class="px-5 py-2 bg-gray-300 hover:bg-gray-400 rounded-md">Prev</button>
        <button (click)="next()" class="px-5 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md">Next</button>
      </div> -->

    </div>
  </div>
</div>
